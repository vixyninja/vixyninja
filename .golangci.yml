version: "2"

issues:
  max-same-issues: 50

formatters:
  enable:
    - gofumpt # checks if the code is formatted according to 'gofumpt' command
    - goimports # checks if the code and import statements are formatted according to the 'goimports' command
    - golines # checks if code is formatted, and fixes long lines
    - gci # checks if code and import statements are formatted, with additional rules
    - gofmt # checks if the code is formatted according to 'gofmt' command
    - swaggo # formats swaggo comments

  settings:
    # gci:
    #   # Section configuration to compare against.
    #   # Section names are case-insensitive and may contain parameters in ().
    #   # The default order of sections is `standard > default > custom > blank > dot > alias > localmodule`.
    #   # If `custom-order` is `true`, it follows the order of `sections` option.
    #   # Default: ["standard", "default"]
    #   sections:
    #     - standard # Standard section: captures all standard packages.
    #     - default # Default section: contains all imports that could not be matched to another section type.
    #     - prefix(github.com/vixyninja/go-blocks) # Custom section: groups all imports with the specified Prefix.
    #     - blank # Blank section: contains all blank imports. This section is not present unless explicitly enabled.
    #     - dot # Dot section: contains all dot imports. This section is not present unless explicitly enabled.
    #     - alias # Alias section: contains all alias imports. This section is not present unless explicitly enabled.
    #     - localmodule # Local module section: contains all local packages. This section is not present unless explicitly enabled.
    #   # Checks that no inline comments are present.
    #   # Default: false
    #   no-inline-comments: true
    #   # Checks that no prefix comments (comment lines above an import) are present.
    #   # Default: false
    #   no-prefix-comments: true
    #   # Enable custom order of sections.
    #   # If `true`, make the section order the same as the order of `sections`.
    #   # Default: false
    #   custom-order: false
    #   # Drops lexical ordering for custom sections.
    #   # Default: false
    #   no-lex-order: true
    # goimports:
    #   local-prefixes:
    #     - github.com/vixyninja/go-blocks
    gofumpt:
      extra-rules: true
    golines:
      max-len: 1200

linters:
  enable:
    # - arangolint # Enforces best practices for ArangoDB client usage
    - asasalint # Detects passing []any into variadic ...any functions
    # - asciicheck # Disallows non-ASCII characters in identifiers
    # - bidichk # Detects dangerous bidirectional Unicode sequences
    - bodyclose # Ensures HTTP response bodies are properly closed
    # - canonicalheader # Validates canonical HTTP header formatting
    # - containedctx # Flags context.Context stored inside struct fields
    # - contextcheck # Checks that functions use proper parent/child context
    - copyloopvar # Detects copying loop variables in closures (Go 1.22+)
    # - cyclop # Checks cyclomatic complexity of functions
    # - decorder # Enforces declaration order of types/vars/consts/funcs
    - depguard # Restricts or enforces import of specific packages
    # - dogsled # Warns on multiple blank identifiers in assignments (_)
    - dupl # Reports duplicated code blocks
    # - dupword # Detects duplicate words in comments
    - durationcheck # Flags multiplication of two time.Duration values
    # - embeddedstructfieldcheck # Ensures embedded structs do not shadow fields
    # - err113 # Enforces typed errors instead of naked fmt.Errorf
    - errcheck # Ensures errors returned by functions are checked
    # - errchkjson # Warns on unsupported or unsafe JSON (un)marshal types
    - errname # Enforces ErrXxx naming convention for sentinel errors
    - errorlint # Detects incorrect usage of Go 1.13+ error wrapping
    # - exhaustive # Ensures switch statements cover all enum variants
    # - exhaustruct # Requires all struct fields to be initialized
    - exptostd # Recommends stdlib replacements for exp/ packages
    # - fatcontext # Detects creating new contexts inside loops
    # - forbidigo # Forbids use of certain identifiers or functions
    # - forcetypeassert # Flags forced type assertions without ok check
    # - funcorder # Enforces function/method/constructor order rules
    # - funlen # Flags overly long functions
    # - ginkgolinter # Enforces best practices for Ginkgo/Gomega tests
    - gocheckcompilerdirectives # Validates //go: compiler directives
    - gochecknoglobals # Disallows global variables
    - gochecknoinits # Disallows init() functions
    - gochecksumtype # Checks sum type exhaustiveness (Go 1.21+)
    - gocognit # Checks cognitive complexity of functions
    - goconst # Detects repeated strings/constants
    - gocritic # Large collection of bug/perf/style checks
    - gocyclo # Another cyclomatic complexity checker
    # - godot # Ensures comments end with a period
    - godox # Reports TODO/FIXME/HACK notes in comments
    # - goheader # Enforces file header/license format
    - gomoddirectives # Checks use of replace/retract/exclude in go.mod
    - gomodguard # Enforces allow/deny lists for dependencies
    - goprintffuncname # Ensures printf-like func names end with f
    - gosec # Security scanner for Go code
    # - gosmopolitan # Flags i18n/L10n anti-patterns
    - govet # Standard vet checks for suspicious constructs
    # - grouper # Analyzes expression grouping consistency
    # - iface # Flags unnecessary/incorrect interface usage
    # - importas # Enforces consistent import aliases
    # - inamedparam # Ensures interfaces have named parameters
    - ineffassign # Detects ineffectual assignments
    # - interfacebloat # Warns on interfaces with too many methods
    - intrange # Suggests using range-over-int loops when possible
    # - ireturn # Enforces "accept interfaces, return concrete types"
    # - lll # Flags long lines
    - loggercheck # Validates key-value logger usage (zap/logr/etc.)
    # - maintidx # Computes maintainability index per function
    - makezero # Flags make([]T, N) where N should be 0
    - mirror # Detects incorrect byte/string mirror patterns
    # - misspell # Detects common English misspellings
    # - mnd # Flags magic numbers
    # - musttag # Ensures struct tags meet requirements
    # - nakedret # Flags naked return statements
    # - nestif # Flags deeply nested if statements
    - nilerr # Detects patterns where err != nil but nil is returned
    # - nilnesserr # Combines nilerr & nilness for deeper nil analysis
    - nilnil # Flags returning both nil value and nil error
    # - nlreturn # Enforces blank line before return statements
    - noctx # Detects HTTP requests made without context
    # - noinlineerr # Prevents inline error handling (if err := ...;)
    - nolintlint # Validates //nolint comments
    # - nonamedreturns # Disallows named return values
    # - nosprintfhostport # Warns misuse of fmt.Sprintf for host:port
    # - paralleltest # Ensures proper use of t.Parallel in tests
    # - perfsprint # Suggests faster alternatives to fmt.Sprintf
    # - prealloc # Suggests slice preallocation when beneficial
    - predeclared # Warns when shadowing Go predeclared identifiers
    # - promlinter # Validates Prometheus metric naming conventions
    # - protogetter # Requires proto getters instead of direct field access
    # - reassign # Detects reassignment of package-level variables
    - recvcheck # Validates receiver naming/style consistency
    - revive # Highly configurable style linter (golint replacement)
    - rowserrcheck # Ensures sql.Rows.Err is checked
    # - sloglint # Enforces consistent usage of log/slog
    # - spancheck # Detects incorrect OpenTelemetry span usage
    - sqlclosecheck # Ensures sql.Rows/sql.Stmt are properly closed
    - staticcheck # Powerful set of static analysis checks
    # - tagalign # Ensures struct tags are visually aligned
    # - tagliatelle # Validates struct tags style and format
    - testableexamples # Ensures examples are runnable & testable
    - testifylint # Ensures proper use of testify assertions
    # - testpackage # Enforces *_test package usage for better isolation
    # - thelper # Ensures test helpers call t.Helper()
    # - tparallel # Flags incorrect usage of t.Parallel
    - unconvert # Removes unnecessary type conversions
    # - unparam # Flags unused function parameters
    - unused # Reports unused vars/funcs/constants/types
    - usestdlibvars # Suggests using stdlib constants/vars instead of custom
    - usetesting # Detects shadowing or misuse of testing helpers
    # - varnamelen # Enforces variable name length rules
    - wastedassign # Detects assignments whose values are never used
    - whitespace # Detects extra leading/trailing whitespace
    # - wrapcheck # Ensures errors from external packages are wrapped
    # - wsl # Enforces whitespace layout rules
    # - wsl_v5 # Newer variant of whitespace rules
    - zerologlint # Detects incorrect usage of zerolog API

  # All settings can be found here https://github.com/golangci/golangci-lint/blob/HEAD/.golangci.reference.yml
  settings:
    cyclop:
      # The maximal code complexity to report.
      # Default: 10
      max-complexity: 30
      # The maximal average package complexity.
      # If it's higher than 0.0 (float) the check is enabled.
      # Default: 0.0
      package-average: 10.0

    depguard:
      # Rules to apply.
      #
      # Variables:
      # - File Variables
      #   Use an exclamation mark `!` to negate a variable.
      #   Example: `!$test` matches any file that is not a go test file.
      #
      #   `$all` - matches all go files
      #   `$test` - matches all go test files
      #
      # - Package Variables
      #
      #   `$gostd` - matches all of go's standard library (Pulled from `GOROOT`)
      #
      # Default (applies if no custom rules are defined): Only allow $gostd in all files.
      rules:
        "deprecated":
          # List of file globs that will match this list of settings to compare against.
          # By default, if a path is relative, it is relative to the directory where the golangci-lint command is executed.
          # The placeholder '${base-path}' is substituted with a path relative to the mode defined with `run.relative-path-mode`.
          # The placeholder '${config-path}' is substituted with a path relative to the configuration file.
          # Default: $all
          files:
            - "$all"
          # List of packages that are not allowed.
          # Entries can be a variable (starting with $), a string prefix, or an exact match (if ending with $).
          # Default: []
          deny:
            - pkg: github.com/golang/protobuf
              desc: Use google.golang.org/protobuf instead, see https://developers.google.com/protocol-buffers/docs/reference/go/faq#modules
            - pkg: github.com/satori/go.uuid
              desc: Use github.com/google/uuid instead, satori's package is not maintained
            - pkg: github.com/gofrs/uuid$
              desc: Use github.com/gofrs/uuid/v5 or later, it was not a go module before v5
        "non-test files":
          files:
            - "!$test"
          deny:
            - pkg: math/rand$
              desc: Use math/rand/v2 instead, see https://go.dev/blog/randv2

        # TODO: Enable this once we have a way to test the logx package
        # "non-main files":
        #   files:
        #     - "!**/main.go"
        #   deny:
        #     - pkg: log$
        #       desc: Use log/slog instead, see https://go.dev/blog/slog

    embeddedstructfieldcheck:
      # Checks that sync.Mutex and sync.RWMutex are not used as embedded fields.
      # Default: false
      forbid-mutex: true

    errcheck:
      # Report about not checking of errors in type assertions: `a := b.(MyStruct)`.
      # Such cases aren't reported by default.
      # Default: false
      check-type-assertions: true

    exhaustive:
      # Program elements to check for exhaustiveness.
      # Default: [ switch ]
      check:
        - switch
        - map

    exhaustruct:
      # List of regular expressions to match type names that should be excluded from processing.
      # Anonymous structs can be matched by '<anonymous>' alias.
      # Has precedence over `include`.
      # Each regular expression must match the full type name, including package path.
      # For example, to match type `net/http.Cookie` regular expression should be `.*/http\.Cookie`,
      # but not `http\.Cookie`.
      # Default: []
      exclude:
        # std libs
        - ^net/http.Client$
        - ^net/http.Cookie$
        - ^net/http.Request$
        - ^net/http.Response$
        - ^net/http.Server$
        - ^net/http.Transport$
        - ^net/url.URL$
        - ^os/exec.Cmd$
        - ^reflect.StructField$
        # public libs
        - ^github.com/Shopify/sarama.Config$
        - ^github.com/Shopify/sarama.ProducerMessage$
        - ^github.com/mitchellh/mapstructure.DecoderConfig$
        - ^github.com/prometheus/client_golang/.+Opts$
        - ^github.com/spf13/cobra.Command$
        - ^github.com/spf13/cobra.CompletionOptions$
        - ^github.com/stretchr/testify/mock.Mock$
        - ^github.com/testcontainers/testcontainers-go.+Request$
        - ^github.com/testcontainers/testcontainers-go.FromDockerfile$
        - ^golang.org/x/tools/go/analysis.Analyzer$
        - ^google.golang.org/protobuf/.+Options$
        - ^gopkg.in/yaml.v3.Node$
      # Allows empty structures in return statements.
      # Default: false
      allow-empty-returns: true

    funcorder:
      # Checks if the exported methods of a structure are placed before the non-exported ones.
      # Default: true
      struct-method: false

    funlen:
      # Checks the number of lines in a function.
      # If lower than 0, disable the check.
      # Default: 60
      lines: 100
      # Checks the number of statements in a function.
      # If lower than 0, disable the check.
      # Default: 40
      statements: 50

    gochecksumtype:
      # Presence of `default` case in switch statements satisfies exhaustiveness, if all members are not listed.
      # Default: true
      default-signifies-exhaustive: false

    gocognit:
      # Minimal code complexity to report.
      # Default: 30 (but we recommend 10-20)
      min-complexity: 20

    gocritic:
      # Settings passed to gocritic.
      # The settings key is the name of a supported gocritic checker.
      # The list of supported checkers can be found at https://go-critic.com/overview.
      settings:
        captLocal:
          # Whether to restrict checker to params only.
          # Default: true
          paramsOnly: false
        underef:
          # Whether to skip (*x).method() calls where x is a pointer receiver.
          # Default: true
          skipRecvDeref: false

    godoclint:
      # List of rules to enable in addition to the default set.
      # Default: empty
      enable:
        # Assert no unused link in godocs.
        # https://github.com/godoc-lint/godoc-lint?tab=readme-ov-file#no-unused-link
        - no-unused-link

    govet:
      # Enable all analyzers.
      # Default: false
      enable-all: true
      # Disable analyzers by name.
      # Run `GL_DEBUG=govet golangci-lint run --enable=govet` to see default, all available analyzers, and enabled analyzers.
      # Default: []
      disable:
        - fieldalignment # too strict
      # Settings per analyzer.
      settings:
        shadow:
          # Whether to be strict about shadowing; can be noisy.
          # Default: false
          strict: false

    inamedparam:
      # Skips check for interface methods with only a single parameter.
      # Default: false
      skip-single-param: true

    mnd:
      # List of function patterns to exclude from analysis.
      # Values always ignored: `time.Date`,
      # `strconv.FormatInt`, `strconv.FormatUint`, `strconv.FormatFloat`,
      # `strconv.ParseInt`, `strconv.ParseUint`, `strconv.ParseFloat`.
      # Default: []
      ignored-functions:
        - args.Error
        - flag.Arg
        - flag.Duration.*
        - flag.Float.*
        - flag.Int.*
        - flag.Uint.*
        - os.Chmod
        - os.Mkdir.*
        - os.OpenFile
        - os.WriteFile
        - prometheus.ExponentialBuckets.*
        - prometheus.LinearBuckets

    nakedret:
      # Make an issue if func has more lines of code than this setting, and it has naked returns.
      # Default: 30
      max-func-lines: 0

    nolintlint:
      # Exclude following linters from requiring an explanation.
      # Default: []
      allow-no-explanation:
        [funlen, gocognit, golines, gocyclo, gocritic, gochecknoglobals]
      # Enable to require an explanation of nonzero length after each nolint directive.
      # Default: false
      require-explanation: true
      # Enable to require nolint directives to mention the specific linter being suppressed.
      # Default: false
      require-specific: true

    perfsprint:
      # Optimizes into strings concatenation.
      # Default: true
      strconcat: false

    reassign:
      # Patterns for global variable names that are checked for reassignment.
      # See https://github.com/curioswitch/go-reassign#usage
      # Default: ["EOF", "Err.*"]
      patterns:
        - ".*"

    rowserrcheck:
      # database/sql is always checked.
      # Default: []
      packages:
        - github.com/jmoiron/sqlx

    sloglint:
      # Enforce not using global loggers.
      # Values:
      # - "": disabled
      # - "all": report all global loggers
      # - "default": report only the default slog logger
      # https://github.com/go-simpler/sloglint?tab=readme-ov-file#no-global
      # Default: ""
      no-global: all
      # Enforce using methods that accept a context.
      # Values:
      # - "": disabled
      # - "all": report all contextless calls
      # - "scope": report only if a context exists in the scope of the outermost function
      # https://github.com/go-simpler/sloglint?tab=readme-ov-file#context-only
      # Default: ""
      context: scope

    staticcheck:
      # SAxxxx checks in https://staticcheck.dev/docs/configuration/options/#checks
      # Example (to disable some checks): [ "all", "-SA1000", "-SA1001"]
      # Default: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]
      checks:
        - all
        # Incorrect or missing package comment.
        # https://staticcheck.dev/docs/checks/#ST1000
        - -ST1000
        # Use consistent method receiver names.
        # https://staticcheck.dev/docs/checks/#ST1016
        - -ST1016
        # Omit embedded fields from selector expression.
        # https://staticcheck.dev/docs/checks/#QF1008
        - -QF1008

    usetesting:
      # Enable/disable `os.TempDir()` detections.
      # Default: false
      os-temp-dir: true

    revive:
      # Configuration for specific rules.
      rules:
        - name: package-comments
          disabled: true
        - name: exported
          disabled: true

    gomoddirectives:
      #  Enforce that all 'replace' directives in go.mod point to valid versions or paths.
      replace-local: true

  exclusions:
    warn-unused: true
    presets:
      - std-error-handling
      - common-false-positives
    rules:
      - path: init\.go
        linters:
          - gochecknoinits
          - nolintlint
# Options for analysis running.
run:
  # Timeout for total work, e.g. 30s, 5m, 5m30s.
  # If the value is lower or equal to 0, the timeout is disabled.
  # Default: 0 (disabled)
  timeout: 5m
  # The mode used to evaluate relative paths.
  # It's used by exclusions, Go plugins, and some linters.
  # The value can be:
  # - `gomod`: the paths will be relative to the directory of the `go.mod` file.
  # - `gitroot`: the paths will be relative to the git root (the parent directory of `.git`).
  # - `cfg`: the paths will be relative to the configuration file.
  # - `wd` (NOT recommended): the paths will be relative to the place where golangci-lint is run.
  # Default: cfg
  relative-path-mode: gomod
  # Exit code when at least one issue was found.
  # Default: 1
  issues-exit-code: 2
  # Include test files or not.
  # Default: true
  tests: false
  # List of build tags, all linters use it.
  # Default: []
  build-tags:
    - wireinject
    - integration
  # If set, we pass it to "go list -mod={option}". From "go help modules":
  # If invoked with -mod=readonly, the go command is disallowed from the implicit
  # automatic updating of go.mod described above. Instead, it fails when any changes
  # to go.mod are needed. This setting is most useful to check that go.mod does
  # not need updates, such as in a continuous integration and testing system.
  # If invoked with -mod=vendor, the go command assumes that the vendor
  # directory holds the correct copies of dependencies and ignores
  # the dependency descriptions in go.mod.
  #
  # Allowed values: readonly|vendor|mod
  # Default: ""
  modules-download-mode: readonly
  # Allow multiple parallel golangci-lint instances running.
  # If false, golangci-lint acquires file lock on start.
  # Default: false
  allow-parallel-runners: true
  # Allow multiple golangci-lint instances running, but serialize them around a lock.
  # If false, golangci-lint exits with an error if it fails to acquire file lock on start.
  # Default: false
  allow-serial-runners: true
  # Define the Go version limit.
  # Default: use Go version from the go.mod file, fallback on the env var `GOVERSION`, fallback on 1.22.
  go: "1.25.0"
  # Number of operating system threads (`GOMAXPROCS`) that can execute golangci-lint simultaneously.
  # Default: 0 (automatically set to match Linux container CPU quota and
  # fall back to the number of logical CPUs in the machine)
  concurrency: 4

severity:
  # Set the default severity for issues.
  #
  # If severity rules are defined and the issues do not match or no severity is provided to the rule
  # this will be the default severity applied.
  # Severities should match the supported severity names of the selected out format.
  # - Code climate: https://docs.codeclimate.com/docs/issues#issue-severity
  # - Checkstyle: https://checkstyle.sourceforge.io/property_types.html#SeverityLevel
  # - GitHub: https://help.github.com/en/actions/reference/workflow-commands-for-github-actions#setting-an-error-message
  # - TeamCity: https://www.jetbrains.com/help/teamcity/service-messages.html#Inspection+Instance
  #
  # `@linter` can be used as severity value to keep the severity from linters (e.g. revive, gosec, ...)
  #
  # Default: ""
  default: error
  # When a list of severity rules are provided, severity information will be added to lint issues.
  # Severity rules have the same filtering capability as exclude rules
  # except you are allowed to specify one matcher per severity rule.
  #
  # `@linter` can be used as severity value to keep the severity from linters (e.g. revive, gosec, ...)
  #
  # Only affects out formats that support setting severity information.
  #
  # Default: []
  rules:
    - linters:
        - dupl
      severity: info
